<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Custom Iframe Viewer</title>
<style>
  body {
    background: #0a0f21;
    color: #0af;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    margin: 0;
    padding: 20px;
    display: flex;
    flex-direction: column;
    height: 100vh;
    user-select: none;
  }
  h2 {
    color: #08f;
    margin-bottom: 12px;
    text-align: center;
  }
  .controls {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 10px;
    margin-bottom: 15px;
  }
  input[type="text"] {
    flex: 1 1 350px;
    padding: 10px 15px;
    font-size: 16px;
    border-radius: 5px;
    border: none;
    outline: none;
    background-color: #1b2240;
    color: #0af;
    box-shadow: 0 0 10px #0af44a44 inset;
  }
  select {
    padding: 10px 15px;
    font-size: 16px;
    border-radius: 5px;
    border: none;
    background: #1b2240;
    color: #0af;
    cursor: pointer;
    box-shadow: 0 0 8px #0af44a44 inset;
  }
  button {
    background: linear-gradient(145deg, #0033cc, #001a99);
    border: none;
    padding: 10px 16px;
    font-size: 14px;
    color: #0af;
    font-weight: 600;
    border-radius: 5px;
    cursor: pointer;
    user-select: none;
    box-shadow: 0 0 15px #0077ff88;
    transition: background 0.3s ease;
  }
  button:hover {
    background: linear-gradient(145deg, #0055ff, #0033cc);
    box-shadow: 0 0 20px #00aaffaa;
  }
  iframe {
    flex-grow: 1;
    border: 2px solid #0080ff;
    border-radius: 8px;
    width: 100%;
    min-height: 500px;
    transition: box-shadow 0.3s ease;
  }
  iframe.fullscreen {
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    width: 100vw !important;
    height: 100vh !important;
    z-index: 9999;
    border-radius: 0;
    box-shadow: 0 0 30px #0077ffcc !important;
  }
  .footer {
    text-align: center;
    font-size: 14px;
    margin-top: 10px;
    color: #0047b3cc;
  }
  #sourceOverlay {
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background: #001122ee;
    color: #0af;
    z-index: 10000;
    display: none;
    flex-direction: column;
  }
  #sourceOverlay textarea {
    flex-grow: 1;
    background: #000c22;
    border: none;
    color: #0af;
    font-family: monospace;
    font-size: 14px;
    padding: 15px;
    resize: none;
    outline:none;
  }
  #closeSourceBtn {
    align-self: flex-end;
    margin: 5px 15px;
    background: #002277;
    border-radius: 5px;
    padding: 8px 14px;
    font-weight: 700;
    cursor: pointer;
  }
  #closeSourceBtn:hover {
    background: #0044ff;
  }
</style>
</head>
<body>
  <h2>üì• Custom Iframe Viewer</h2>

  <div class="controls" aria-label="Controls">
    <input id="urlInput" type="text" placeholder="Enter URL (e.g. https://example.com)" autocomplete="off" />
    
    <select id="cloakSelect" title="Cloak tab as">
      <option value="">-- Cloak As --</option>
      <option value="classroom">Google Classroom</option>
      <option value="docs">Google Docs</option>
      <option value="drive">Google Drive</option>
      <option value="none">None</option>
    </select>

    <button onclick="loadIframe()">Load</button>
    <button onclick="downloadIframeContent()">Download HTML</button>
    <button onclick="openDirect()">Open Direct</button>
    <button onclick="openBlank()">Open Blank</button>
    <button onclick="toggleFullscreen()" id="fullscreenBtn">Fullscreen</button>
    <button onclick="viewHtmlSource()">View HTML Source</button>
  </div>

  <iframe id="myIframe" src="" sandbox="allow-scripts allow-same-origin allow-forms allow-popups" title="Content iframe"></iframe>

  <div class="footer">Developed for Chromebook ‚Äì Stylish & Sharp Interface</div>

  <div id="sourceOverlay" role="dialog" aria-modal="true" aria-labelledby="sourceTitle">
    <button id="closeSourceBtn" onclick="closeHtmlSource()">Close ‚úñÔ∏è</button>
    <textarea readonly id="sourceTextarea" spellcheck="false" aria-label="HTML source code"></textarea>
  </div>

<script>
  const iframe = document.getElementById('myIframe');
  const urlInput = document.getElementById('urlInput');
  const cloakSelect = document.getElementById('cloakSelect');
  const fullscreenBtn = document.getElementById('fullscreenBtn');
  const sourceOverlay = document.getElementById('sourceOverlay');
  const sourceTextarea = document.getElementById('sourceTextarea');

  const faviconMap = {
    classroom: 'https://ssl.gstatic.com/classroom/favicon.png',
    docs: 'https://ssl.gstatic.com/docs/documents/images/kix-favicon7.ico',
    drive: 'https://ssl.gstatic.com/images/branding/product/1x/drive_2020q4_48dp.png'
  };

  function setFavicon(url) {
    let link = document.querySelector("link[rel~='icon']");
    if (!link) {
      link = document.createElement('link');
      link.rel = 'icon';
      document.head.appendChild(link);
    }
    link.href = url;
  }

  function setTitle(text) {
    document.title = text;
  }

  cloakSelect.addEventListener('change', () => {
    const val = cloakSelect.value;
    if (val === 'none' || val === '') {
      setTitle('Custom Iframe Viewer');
      setFavicon('');
    } else {
      setTitle('Google ' + val.charAt(0).toUpperCase() + val.slice(1));
      setFavicon(faviconMap[val] || '');
    }
  });

  function loadIframe() {
    let url = urlInput.value.trim();
    if (!url) {
      alert('Please enter a URL.');
      return;
    }
    if (!url.startsWith('http://') && !url.startsWith('https://')) {
      url = 'https://' + url;
    }
    iframe.src = url;
  }

  function downloadIframeContent() {
    try {
      const doc = iframe.contentDocument || iframe.contentWindow.document;
      const htmlContent = doc.documentElement.outerHTML;
      const blob = new Blob([htmlContent], { type: 'text/html' });
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = 'downloaded_iframe.html';
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
    } catch (e) {
      alert('Cannot access iframe content due to cross-origin restrictions.');
    }
  }

  function openDirect() {
    let url = urlInput.value.trim();
    if (!url) {
      alert('Please enter a URL.');
      return;
    }
    if (!url.startsWith('http://') && !url.startsWith('https://')) {
      url = 'https://' + url;
    }
    window.open(url, '_blank', 'noopener,noreferrer');
  }

  function openBlank() {
    window.open('about:blank', '_blank', 'noopener,noreferrer');
  }

  function toggleFullscreen() {
    if (!document.fullscreenElement) {
      iframe.requestFullscreen().catch(err => {
        alert(`Error trying to enable full-screen mode: ${err.message}`);
      });
      fullscreenBtn.textContent = 'Exit Fullscreen';
    } else {
      document.exitFullscreen();
      fullscreenBtn.textContent = 'Fullscreen';
    }
  }

  document.addEventListener('fullscreenchange', () => {
    if (!document.fullscreenElement) {
      fullscreenBtn.textContent = 'Fullscreen';
    }
  });

  async function viewHtmlSource() {
    const url = urlInput.value.trim();
    if (!url) {
      alert('Please enter a URL.');
      return;
    }
    let fetchUrl = url;
    if (!fetchUrl.startsWith('http://') && !fetchUrl.startsWith('https://')) {
      fetchUrl = 'https://' + fetchUrl;
    }

    try {
      // fetch HTML source as text
      const response = await fetch(fetchUrl, { mode: 'cors' });
      if(!response.ok) {
        alert('Failed to fetch HTML source: ' + response.status + ' ' + response.statusText);
        return;
      }
      const text = await response.text();
      sourceTextarea.value = text;
      sourceOverlay.style.display = 'flex';
      sourceTextarea.scrollTop = 0;
    } catch (e) {
      alert('Failed to fetch HTML source. Possible CORS restriction or network error.');
    }
  }

  function closeHtmlSource() {
    sourceOverlay.style.display = 'none';
    sourceTextarea.value = '';
  }
</script>
</body>
</html>
